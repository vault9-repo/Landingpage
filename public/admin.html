<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel - PrimePicks</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body { background: #121212; color:#fff; font-family:'Segoe UI',sans-serif; padding:20px; }
  .match-card, .prediction-card { background: rgba(0,0,0,0.75); border-radius:10px; padding:10px; margin-bottom:10px; display:flex; align-items:center; justify-content:space-between; }
  img { height:40px; width:40px; object-fit:contain; }
  .nav-link.active { background-color: #0d6efd; color: #fff; }
</style>
</head>
<body>

<h2>Admin Panel</h2>
<ul class="nav nav-tabs mb-3">
  <li class="nav-item"><a class="nav-link active" id="tab-upcoming" href="#">Upcoming Matches</a></li>
  <li class="nav-item"><a class="nav-link" id="tab-predictions" href="#">Top Predictions</a></li>
  <li class="nav-item"><a class="nav-link" id="tab-clicks" href="#">Clicks</a></li>
</ul>

<div id="upcomingSection">
  <h4>Upcoming Matches</h4>
  <form id="addMatchForm" class="mb-3">
    <input type="date" id="matchDate" required>
    <input type="time" id="matchTime" required>
    <input type="text" id="homeTeam" placeholder="Home Team" required>
    <input type="text" id="awayTeam" placeholder="Away Team" required>
    <input type="text" id="leagueId" placeholder="League ID">
    <button type="submit" class="btn btn-success btn-sm">Add Match</button>
  </form>
  <div id="matchesContainer"></div>
</div>

<div id="predictionSection" style="display:none;">
  <h4>Top Predictions</h4>
  <form id="addPredictionForm" class="mb-3">
    <input type="text" id="predHome" placeholder="Home Team" required>
    <input type="text" id="predAway" placeholder="Away Team" required>
    <button type="submit" class="btn btn-success btn-sm">Add Prediction</button>
  </form>
  <div id="predictionsContainer"></div>
</div>

<div id="clickSection" style="display:none;">
  <h4>Todayâ€™s Clicks</h4>
  <p>Homepage clicks: <span id="homepageClicks">0</span></p>
  <p>Download clicks: <span id="downloadClicks">0</span></p>
  <button class="btn btn-info btn-sm" id="refreshClicks">Refresh</button>
</div>

<script>
// Tab toggling
const tabUpcoming = document.getElementById("tab-upcoming");
const tabPredictions = document.getElementById("tab-predictions");
const tabClicks = document.getElementById("tab-clicks");
const upcomingSection = document.getElementById("upcomingSection");
const predictionSection = document.getElementById("predictionSection");
const clickSection = document.getElementById("clickSection");

tabUpcoming.addEventListener("click",()=>{
  upcomingSection.style.display="block";
  predictionSection.style.display="none";
  clickSection.style.display="none";
  tabUpcoming.classList.add("active");
  tabPredictions.classList.remove("active");
  tabClicks.classList.remove("active");
  loadMatches();
});
tabPredictions.addEventListener("click",()=>{
  upcomingSection.style.display="none";
  predictionSection.style.display="block";
  clickSection.style.display="none";
  tabUpcoming.classList.remove("active");
  tabPredictions.classList.add("active");
  tabClicks.classList.remove("active");
  loadPredictions();
});
tabClicks.addEventListener("click",()=>{
  upcomingSection.style.display="none";
  predictionSection.style.display="none";
  clickSection.style.display="block";
  tabUpcoming.classList.remove("active");
  tabPredictions.classList.remove("active");
  tabClicks.classList.add("active");
  loadClicks();
});

// ---------------- MATCHES ----------------
const matchesContainer = document.getElementById("matchesContainer");
const addMatchForm = document.getElementById("addMatchForm");

async function loadMatches(){
  const res = await fetch("/admin/fixtures");
  const data = await res.json();
  matchesContainer.innerHTML="";
  data.forEach(f=>{
    const div = document.createElement("div");
    div.classList.add("match-card");
    div.innerHTML = `<span>${f.date} ${f.time} - ${f.homeTeam} vs ${f.awayTeam} (League: ${f.leagueId||'-'})</span>
    <span>
      <button class="btn btn-warning btn-sm edit" data-id="${f._id}">Edit</button>
      <button class="btn btn-danger btn-sm delete" data-id="${f._id}">Delete</button>
    </span>`;
    matchesContainer.appendChild(div);
  });

  document.querySelectorAll(".delete").forEach(btn=>btn.addEventListener("click", async ()=>{
    const id = btn.dataset.id;
    await fetch("/admin/fixture",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({_id:id})});
    loadMatches();
  }));

  document.querySelectorAll(".edit").forEach(btn=>btn.addEventListener("click", async ()=>{
    const id = btn.dataset.id;
    const homeTeam = prompt("Edit Home Team");
    const awayTeam = prompt("Edit Away Team");
    const date = prompt("Edit Date YYYY-MM-DD");
    const time = prompt("Edit Time HH:MM");
    const leagueId = prompt("Edit League ID");
    if(homeTeam && awayTeam && date && time){
      await fetch("/admin/fixture",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ _id:id, homeTeam, awayTeam, date, time, leagueId })});
      loadMatches();
    }
  }));
}

addMatchForm.addEventListener("submit", async e=>{
  e.preventDefault();
  const date = document.getElementById("matchDate").value;
  const time = document.getElementById("matchTime").value;
  const homeTeam = document.getElementById("homeTeam").value;
  const awayTeam = document.getElementById("awayTeam").value;
  const leagueId = document.getElementById("leagueId").value;
  await fetch("/admin/fixture",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date,time,homeTeam,awayTeam,leagueId})});
  addMatchForm.reset();
  loadMatches();
});

// ---------------- PREDICTIONS ----------------
const predictionsContainer = document.getElementById("predictionsContainer");
const addPredictionForm = document.getElementById("addPredictionForm");

async function loadPredictions(){
  const res = await fetch("/admin/predictions");
  const data = await res.json();
  predictionsContainer.innerHTML="";
  data.forEach(p=>{
    const div = document.createElement("div");
    div.classList.add("prediction-card");
    div.innerHTML = `<span>${p.homeTeam} vs ${p.awayTeam}</span>
    <span>
      <button class="btn btn-warning btn-sm editPred" data-id="${p._id}">Edit</button>
      <button class="btn btn-danger btn-sm deletePred" data-id="${p._id}">Delete</button>
    </span>`;
    predictionsContainer.appendChild(div);
  });

  document.querySelectorAll(".deletePred").forEach(btn=>btn.addEventListener("click", async ()=>{
    const id = btn.dataset.id;
    await fetch("/admin/prediction",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({_id:id})});
    loadPredictions();
  }));

  document.querySelectorAll(".editPred").forEach(btn=>btn.addEventListener("click", async ()=>{
    const id = btn.dataset.id;
    const homeTeam = prompt("Edit Home Team");
    const awayTeam = prompt("Edit Away Team");
    if(homeTeam && awayTeam){
      await fetch("/admin/prediction",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ _id:id, homeTeam, awayTeam })});
      loadPredictions();
    }
  }));
}

addPredictionForm.addEventListener("submit", async e=>{
  e.preventDefault();
  const homeTeam = document.getElementById("predHome").value;
  const awayTeam = document.getElementById("predAway").value;
  await fetch("/admin/prediction",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({homeTeam,awayTeam})});
  addPredictionForm.reset();
  loadPredictions();
});

// ---------------- CLICKS ----------------
const homepageClicks = document.getElementById("homepageClicks");
const downloadClicks = document.getElementById("downloadClicks");
const refreshClicks = document.getElementById("refreshClicks");

async function loadClicks(){
  try{
    const today = new Date().toISOString().split("T")[0];
    const res = await fetch(`/api/clicks?date=${today}`);
    const data = await res.json();
    let homepage = 0, download = 0;
    data.forEach(c=>{
      if(c.type==='homepage') homepage=c.count;
      if(c.type==='download') download=c.count;
    });
    homepageClicks.innerText = homepage;
    downloadClicks.innerText = download;
  }catch(err){
    console.error("Error fetching clicks:", err);
  }
}
refreshClicks.addEventListener("click", loadClicks);

// Initial load
loadMatches();
loadPredictions();
loadClicks();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
